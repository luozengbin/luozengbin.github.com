#+TITLE: [メモ]CentOS7にownCloud導入記録
#+DATE: 2014-11-08
#+SETUPFILE: ~/.emacs.d/blogs/octopress/setupfile.org
#+JEKYLL_LAYOUT: post
#+JEKYLL_CATEGORIES: linux
#+JEKYLL_TAGS: ownCloud
#+JEKYLL_COMMENTS: true
#+JEKYLL_PUBLISHED: true

{{{more}}}

* 構成
#+begin_example
+------------+        +-----------+       +-------------+
|            |        |           |       |             |
| Apache   mod-php -->| ownCloud  +-------+  PostgreSQL |
|            |        |           |       |             |
+------------+        +-----------+       +-------------+
#+end_example

* インストール

#+begin_example
yum install httpd postgresql php php-pgsql sqlite php-dom php-mbstring
#+end_example

ownCloudのインストール
#+begin_example
$ cd /tmp
$ wget https://download.owncloud.org/community/owncloud-7.0.2.tar.bz2
$ tar -jxvf owncloud-7.0.2.tar.bz2
$ sudo cp -rf owncloud /var/www
$ sudo chown -R apache:apache /var/www/owncloud
#+end_example

ownCloud用のデータベースの構築する
#+begin_example
$ sudo -u postgres createuser --pwprompt owncloud      ★接続ユーザの作成
$ sudo -u postgres createdb --owner=owncloud owncloud  ★データベース作成
#+end_example


Apacheの設定 =/etc/httpd/conf.d/httpd-ownclond.conf=
#+begin_example
#
#  ownCloud setting for Apache 2.4
#
<VirtualHost *:50800>
  DocumentRoot "/var/www/owncloud"
  ServerName owncloud.home
  ErrorLog "/var/log/httpd/owncloud_error_log"
  CustomLog "/var/log/httpd/owncloud_access_log" common

  <Directory /var/www/owncloud>
    Options SymLinksIfOwnerMatch MultiViews
    AllowOverride All
    <RequireAll>
      Require ip 192.168.100.0/24
      Require not ip 192.168.100.1
    </RequireAll>
  </Directory>
</VirtualHost>

#+end_example


#+begin_example
openssl genrsa -aes128 2048 > owncloud-server.key

openssl req -new -key owncloud-server.key > owncloud-server.csr

openssl x509 -in owncloud-server.csr -days 365 -req -signkey owncloud-server.key > owncloud-server.crt

openssl rsa -in owncloud-server.key -out owncloud-server.key
#+end_example

#+begin_example
[root@nassrv certs]# openssl genrsa -aes128 2048 > owncloud-server.key
Generating RSA private key, 2048 bit long modulus
.+++
..........+++
e is 65537 (0x10001)
Enter pass phrase:
Verifying - Enter pass phrase:
aborted!
140654455433120:error:0906906F:PEM routines:PEM_ASN1_write_bio:read key:pem_lib.c:382:
[root@nassrv certs]# openssl genrsa -aes128 2048 > owncloud-server.key^C
[root@nassrv certs]# ^C
[root@nassrv certs]# ls -al
合計 28
drwxr-xr-x. 2 root root 4096 11月  8 22:11 .
drwxr-xr-x. 5 root root   76 10月 13 18:14 ..
-rw-r--r--. 1 root root 2388  8月 14 04:21 Makefile
lrwxrwxrwx. 1 root root   49 10月 13 18:14 ca-bundle.crt -> /etc/pki/ca-trust/extracted/pem/tls-ca-bundle.pem
lrwxrwxrwx. 1 root root   55 10月 13 18:14 ca-bundle.trust.crt -> /etc/pki/ca-trust/extracted/openssl/ca-bundle.trust.crt
-rw-------  1 root root 1456 10月 13 20:16 localhost.crt
-rwxr-xr-x. 1 root root  610  8月 14 04:21 make-dummy-cert
-rw-r--r--  1 root root    0 11月  8 22:11 owncloud-server.key
-rwxr-xr-x. 1 root root  829  8月 14 04:21 renew-dummy-cert
-rw-------  1 root root 1310 10月 13 21:52 ttrss-server.crt
-rw-------  1 root root 1058 10月 13 21:51 ttrss-server.csr
[root@nassrv certs]# rm -rf owncloud-server.key
[root@nassrv certs]# openssl genrsa -aes128 2048 > owncloud-server.key
Generating RSA private key, 2048 bit long modulus
..............+++
..........................................................................+++
e is 65537 (0x10001)
Enter pass phrase:
Verifying - Enter pass phrase:
[root@nassrv certs]# openssl req -new -key owncloud-server.key > owncloud-server.csr
Enter pass phrase for owncloud-server.key:
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter '.', the field will be left blank.
-----
Country Name (2 letter code) [XX]:JP
State or Province Name (full name) []:Tokyo
Locality Name (eg, city) [Default City]:Tokyo-to,Arakawa-ku     
Organization Name (eg, company) [Default Company Ltd]:
Organizational Unit Name (eg, section) []:
Common Name (eg, your name or your server's hostname) []:owncloud.jizai.mydns.jp
Email Address []:

Please enter the following 'extra' attributes
to be sent with your certificate request
A challenge password []:
An optional company name []:


# mv owncloud-server.key ../private/
# chmod 600 owncloud*
# chmod 600 ../private/owncloud*
# chown apache:apache owncloud*
# chown apache:apache ../private/owncloud*
#+end_example

#+begin_example
libreoffice-base libreoffice-bsh libreoffice-calc libreoffice-core libreoffice-draw libreoffice-impress libreoffice-emailmerge libreoffice-glade libreoffice-graphicfilter libreoffice-headless libreoffice-langpack-ja
#+end_example


#+begin_example
wget https://downloads.plex.tv/plex-media-server/0.9.11.1.678-c48ffd2/plexmediaserver-0.9.11.1.678-c48ffd2.x86_64.rpm
#+end_example

#+begin_example 
$ sudo rpm -iv plexmediaserver-0.9.11.1.678-c48ffd2.x86_64.rpm 
[sudo] password for akira: 
パッケージの準備中...
plexmediaserver-0.9.11.1.678-c48ffd2.x86_64
#+end_example

#+begin_example
/etc/init.d/plexmediaserver
/etc/security/limits.d/plex.conf
/etc/sysconfig/PlexMediaServer
/etc/yum.repos.d/plex.repo
/etc/zypp/repos.d/plex.repo
/lib/systemd/system/plexmediaserver.service
/usr/lib/plexmediaserver
/usr/lib/plexmediaserver/Plex DLNA Server
/usr/lib/plexmediaserver/Plex Media Scanner
/usr/lib/plexmediaserver/Plex Media Server

/usr/lib/plexmediaserver/libavcodec.so.55
/usr/lib/plexmediaserver/libavformat.so.55
/usr/lib/plexmediaserver/libavutil.so.52
/usr/lib/plexmediaserver/libboost_chrono.so.1.56.0
/usr/lib/plexmediaserver/libboost_filesystem.so.1.56.0
/usr/lib/plexmediaserver/libboost_iostreams.so.1.56.0
/usr/lib/plexmediaserver/libboost_locale.so.1.56.0
/usr/lib/plexmediaserver/libboost_program_options.so.1.56.0
/usr/lib/plexmediaserver/libboost_regex.so.1.56.0
/usr/lib/plexmediaserver/libboost_signals.so.1.56.0
/usr/lib/plexmediaserver/libboost_system.so.1.56.0
/usr/lib/plexmediaserver/libboost_thread.so.1.56.0
/usr/lib/plexmediaserver/libcrypto.so.1.0.0
/usr/lib/plexmediaserver/libcurl.so.4
/usr/lib/plexmediaserver/libexpat.so.1
/usr/lib/plexmediaserver/libexslt.so.0
/usr/lib/plexmediaserver/libfreeimage.so
/usr/lib/plexmediaserver/libiconv.so.2
/usr/lib/plexmediaserver/libidn.so.11
/usr/lib/plexmediaserver/libmediainfo.so.0
/usr/lib/plexmediaserver/libminiupnpc.so.10
/usr/lib/plexmediaserver/libnatpmp.so.1
/usr/lib/plexmediaserver/libopencv_core.so.2.4
/usr/lib/plexmediaserver/libopencv_imgproc.so.2.4
/usr/lib/plexmediaserver/libpython2.7.so.1.0
/usr/lib/plexmediaserver/libsoci_core-gcc-3_0.so.3.0.0
/usr/lib/plexmediaserver/libsoci_sqlite3-gcc-3_0.so.3.0.0
/usr/lib/plexmediaserver/libsqlite3.so.0
/usr/lib/plexmediaserver/libssl.so.1.0.0
/usr/lib/plexmediaserver/libswscale.so.2
/usr/lib/plexmediaserver/libvo-aacenc.so.0
/usr/lib/plexmediaserver/libxml2.so.2
/usr/lib/plexmediaserver/libxslt.so.1
/usr/lib/plexmediaserver/libz.so.1
/usr/lib/plexmediaserver/libzen.so.0
/usr/lib/plexmediaserver/plexrsync.pp
/usr/lib/plexmediaserver/start.sh
/usr/local/bin/python
/usr/share/doc/plexmediaserver/README.Redhat
/usr/share/doc/plexmediaserver/copyright


#+end_example

#+begin_example
$ sudo systemctl enable plexmediaserver.service
$ sudo systemctl start plexmediaserver.service
#+end_example


#+begin_example
$ sudo setfacl -m d:g:plex:rwx,g:plex:rwx /var/www/owncloud/data
#+end_example

=rtx810=
#+begin_example 
ip lan2 secure filter in 200093
ip filter 200093 pass * 192.168.100.5 tcp * 32400
#+end_example



* iphoneアプリの設定

* 基本的な使い方

* 参考
- [[http://www.maruko2.com/mw/Apache/SSL%25E8%2587%25AA%25E5%25B7%25B1%25E8%25A8%25BC%25E6%2598%258E%25E6%259B%25B8%25E3%2581%25AE%25E4%25BD%259C%25E6%2588%2590%25E3%2581%25A8mod_ssl%25E3%2581%25AE%25E8%25A8%25AD%25E5%25AE%259A][Apache/SSL自己証明書の作成とmod sslの設定]]

