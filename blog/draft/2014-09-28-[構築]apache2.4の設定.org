#+TITLE: [構築]Apache2.4の設定
#+DATE: 2014-09-28
#+SETUPFILE: ~/.emacs.d/blogs/octopress/setupfile.org
#+JEKYLL_LAYOUT: post
#+JEKYLL_CATEGORIES: linux
#+JEKYLL_TAGS: apache
#+JEKYLL_COMMENTS: true
#+JEKYLL_PUBLISHED: true

* 環境
- OS: CentOS Linux release 7.0.1406
- Apache/2.4.6

* 初期導入
yumからインストールする。
#+begin_example
$ sudo yum install httpd
#+end_example

サービス起動と確認する。
#+begin_example
$ sudo systemctl enable httpd
$ sudo systemctl start httpd

★状態確認
$ sudo systemctl status httpd
httpd.service - The Apache HTTP Server
   Loaded: loaded (/usr/lib/systemd/system/httpd.service; enabled)
   Active: active (running) since 日 2014-09-28 19:15:34 JST; 16min ago
  Process: 2302 ExecStop=/bin/kill -WINCH ${MAINPID} (code=exited, status=0/SUCCESS)
 Main PID: 2308 (httpd)
   Status: "Total requests: 512; Current requests/sec: 0; Current traffic:   0 B/sec"
   CGroup: /system.slice/httpd.service
           ├─2308 /usr/sbin/httpd -DFOREGROUND
           ├─2309 /usr/sbin/httpd -DFOREGROUND
           ├─2310 /usr/sbin/httpd -DFOREGROUND
           ├─2311 /usr/sbin/httpd -DFOREGROUND
           ├─2312 /usr/sbin/httpd -DFOREGROUND
           ├─2313 /usr/sbin/httpd -DFOREGROUND
           ├─2314 /usr/sbin/httpd -DFOREGROUND
           ├─2315 /usr/sbin/httpd -DFOREGROUND
           ├─2333 /usr/sbin/httpd -DFOREGROUND
           ├─2334 /usr/sbin/httpd -DFOREGROUND
           └─2335 /usr/sbin/httpd -DFOREGROUND

 9月 28 19:15:34 nassrv.myhome.local systemd[1]: Started The Apache HTTP S...
Hint: Some lines were ellipsized, use -l to show in full.

★ログ確認
$ sudo cat /var/log/httpd/error_log
[Sun Sep 28 19:37:04.266297 2014] [core:notice] [pid 2447] SELinux policy enabled; httpd running as context system_u:system_r:httpd_t:s0
[Sun Sep 28 19:37:04.268853 2014] [suexec:notice] [pid 2447] AH01232: suEXEC mechanism enabled (wrapper: /usr/sbin/suexec)
[Sun Sep 28 19:37:04.320557 2014] [auth_digest:notice] [pid 2447] AH01757: generating secret for digest authentication ...
[Sun Sep 28 19:37:04.322179 2014] [lbmethod_heartbeat:notice] [pid 2447] AH02282: No slotmem from mod_heartmonitor
[Sun Sep 28 19:37:04.330309 2014] [mpm_prefork:notice] [pid 2447] AH00163: Apache/2.4.6 (CentOS) SVN/1.7.14 configured -- resuming normal operations
[Sun Sep 28 19:37:04.330372 2014] [core:notice] [pid 2447] AH00094: Command line: '/usr/sbin/httpd -D FOREGROUND'
#+end_example

パッケージ構成の確認
#+begin_example
$ rpm -ql httpd
★Apache設定ファイル
/etc/httpd/conf/httpd.conf
/etc/httpd/conf/magic

★機能単位の設定ファイル
/etc/httpd/conf.d/README
/etc/httpd/conf.d/autoindex.conf
/etc/httpd/conf.d/userdir.conf
/etc/httpd/conf.d/welcome.conf

★ロード対象モジュールのリスト定義
/etc/httpd/conf.modules.d/00-base.conf
/etc/httpd/conf.modules.d/00-dav.conf
/etc/httpd/conf.modules.d/00-lua.conf
/etc/httpd/conf.modules.d/00-mpm.conf
/etc/httpd/conf.modules.d/00-proxy.conf
/etc/httpd/conf.modules.d/00-systemd.conf
/etc/httpd/conf.modules.d/01-cgi.conf

★ログ、モジュール、実行時ディレクトリへのリンク
/etc/httpd/logs     -> ../../var/log/httpd
/etc/httpd/modules  -> ../../usr/lib64/httpd/modules
/etc/httpd/run      -> /run/httpd

★ログローテーション制御ファイル
/etc/logrotate.d/httpd

★バイナリ実行時パラメータ定義ファイル
/etc/sysconfig/htcacheclean
/etc/sysconfig/httpd

★pidや実行時ファイルを格納するためのディレクトリ
/run/httpd
/run/httpd/htcacheclean

★サービス定義ファイル
/usr/lib/systemd/system/htcacheclean.service
/usr/lib/systemd/system/httpd.service
/usr/lib/tmpfiles.d/httpd.conf

★この配下にモジュールファイルがインストールされる
/usr/lib64/httpd/modules

★旧バージョン互換コマンド
/usr/libexec/initscripts/legacy-actions/httpd
/usr/libexec/initscripts/legacy-actions/httpd/configtest
/usr/libexec/initscripts/legacy-actions/httpd/graceful

★バイナリ
/usr/sbin/apachectl
/usr/sbin/fcgistarter
/usr/sbin/htcacheclean
/usr/sbin/httpd
/usr/sbin/rotatelogs
/usr/sbin/suexec

★バージョン、ライセンス情報
/usr/share/doc/httpd-2.4.6
/usr/share/doc/httpd-2.4.6/ABOUT_APACHE
/usr/share/doc/httpd-2.4.6/CHANGES
/usr/share/doc/httpd-2.4.6/LICENSE
/usr/share/doc/httpd-2.4.6/NOTICE
/usr/share/doc/httpd-2.4.6/README
/usr/share/doc/httpd-2.4.6/VERSIONING

★設定テンプレートファイル
/usr/share/doc/httpd-2.4.6/httpd-dav.conf
/usr/share/doc/httpd-2.4.6/httpd-default.conf
/usr/share/doc/httpd-2.4.6/httpd-info.conf
/usr/share/doc/httpd-2.4.6/httpd-languages.conf
/usr/share/doc/httpd-2.4.6/httpd-manual.conf
/usr/share/doc/httpd-2.4.6/httpd-mpm.conf
/usr/share/doc/httpd-2.4.6/httpd-multilang-errordoc.conf
/usr/share/doc/httpd-2.4.6/httpd-vhosts.conf
/usr/share/doc/httpd-2.4.6/proxy-html.conf

★エラーページコンテンツ、詳細は下記エラーページ一覧の表を参照する
/usr/share/httpd
/usr/share/httpd/error
/usr/share/httpd/error/README
/usr/share/httpd/error/contact.html.var
/usr/share/httpd/error/include
/usr/share/httpd/error/include/bottom.html
/usr/share/httpd/error/include/spacer.html
/usr/share/httpd/error/include/top.html

★autoindex機能のためのアイコン
/usr/share/httpd/icons
/usr/share/httpd/icons/README

★welcomeページコンテンツ
/usr/share/httpd/noindex
/usr/share/httpd/noindex/css
/usr/share/httpd/noindex/css/fonts
/usr/share/httpd/noindex/images
/usr/share/httpd/noindex/index.html

★manページ
/usr/share/man/man8/apachectl.8.gz
/usr/share/man/man8/fcgistarter.8.gz
/usr/share/man/man8/htcacheclean.8.gz
/usr/share/man/man8/httpd.8.gz
/usr/share/man/man8/rotatelogs.8.gz
/usr/share/man/man8/suexec.8.gz

★キャッシュディレクトリ
/var/cache/httpd
/var/cache/httpd/proxy

★davディレクトリ
/var/lib/dav

★ログ出力ディレクトリ
/var/log/httpd

★wwwコンテンツディレクトリ
/var/www
/var/www/cgi-bin
/var/www/html
#+end_example

初期インストールされたモジュール一覧
|----------------------------+-----------+-------------------------------------------------------------------------------------+---------|
| モジュールファイル         | 2.4新機能 | 説明                                                                                | 必須[1] |
|----------------------------+-----------+-------------------------------------------------------------------------------------+---------|
| mod_access_compat.so       |           |                                                                                     |         |
| mod_actions.so             |           |                                                                                     |         |
| mod_alias.so               |           |                                                                                     | ◯      |
| mod_allowmethods.so        |           |                                                                                     |         |
| mod_asis.so                |           |                                                                                     |         |
| mod_auth_basic.so          |           |                                                                                     |         |
| mod_auth_digest.so         |           |                                                                                     |         |
| mod_authn_anon.so          |           |                                                                                     |         |
| mod_authn_core.so          |           |                                                                                     |         |
| mod_authn_dbd.so           |           |                                                                                     |         |
| mod_authn_dbm.so           |           |                                                                                     |         |
| mod_authn_file.so          |           |                                                                                     |         |
| mod_authn_socache.so       |           |                                                                                     |         |
| mod_authz_core.so          |           |                                                                                     |         |
| mod_authz_dbd.so           |           |                                                                                     |         |
| mod_authz_dbm.so           |           |                                                                                     |         |
| mod_authz_groupfile.so     |           |                                                                                     |         |
| mod_authz_host.so          |           |                                                                                     |         |
| mod_authz_owner.so         |           |                                                                                     |         |
| mod_authz_user.so          |           |                                                                                     |         |
| mod_autoindex.so           |           |                                                                                     |         |
| mod_buffer.so              | ○        | リクエスト、レスポンスの内容をapacheのメモリ内にバッファーリングする                | x       |
| mod_cache.so               |           |                                                                                     |         |
| mod_cache_disk.so          |           |                                                                                     |         |
| mod_cache_socache.so       |           |                                                                                     |         |
| mod_cgi.so                 |           | CGI スクリプトの実行                                                                | x       |
| mod_cgid.so                |           | 外部 CGI デーモンを使った CGI スクリプトの実行                                      | x       |
| mod_charset_lite.so        |           | 特定文字コード変換                                                                  | x       |
| mod_data.so                | ○        | 画像ファイルを RFC2397 の data: 形式のURI に変換する機能                            | x       |
| mod_dav.so                 |           | 分散オーサリングとバージョン管理 (WebDAV) 機能                                      | x       |
| mod_dav_fs.so              |           | mod_dav のためのファイルシステムプロバイダ                                          | x       |
| mod_dav_lock.so            |           | mod_dav 用の汎用ロックモジュール                                                    | x       |
| mod_dbd.so                 |           | データベースコネクション管理モジュール                                              | x       |
| mod_deflate.so             |           | クライアントへ送られる前にコンテンツを圧縮する                                      |         |
| mod_dialup.so              | ○        | 静的コンテンツを限定されたレートで送信する                                          | x       |
| mod_dir.so                 |           | 「最後のスラッシュ」のリダイレクトと、ディレクトリの インデックスファイルを扱う機能 |         |
| mod_dumpio.so              |           | 望むようにすべての I/O をエラーログにダンプする                                     | △      |
| mod_echo.so                |           | プロトコルモジュールの概要を示すための単純なエコーサーバ                            | △      |
| mod_env.so                 |           |                                                                                     |         |
| mod_expires.so             |           |                                                                                     |         |
| mod_ext_filter.so          |           |                                                                                     |         |
| mod_file_cache.so          |           |                                                                                     |         |
| mod_filter.so              |           |                                                                                     |         |
| mod_headers.so             |           |                                                                                     |         |
| mod_heartbeat.so           |           |                                                                                     | x       |
| mod_heartmonitor.so        |           |                                                                                     | x       |
| mod_include.so             |           |                                                                                     |         |
| mod_info.so                |           |                                                                                     | ◯      |
| mod_lbmethod_bybusyness.so |           |                                                                                     |         |
| mod_lbmethod_byrequests.so |           |                                                                                     |         |
| mod_lbmethod_bytraffic.so  |           |                                                                                     |         |
| mod_lbmethod_heartbeat.so  |           |                                                                                     |         |
| mod_log_config.so          |           |                                                                                     | ◯      |
| mod_log_debug.so           |           |                                                                                     | x       |
| mod_log_forensic.so        |           |                                                                                     | ？      |
| mod_logio.so               |           |                                                                                     | △      |
| mod_lua.so                 |           |                                                                                     | x       |
| mod_macro.so               |           |                                                                                     |         |
| mod_mime.so                |           | MIME タイプ、言語、文字セット、エンコーディングの関連付けを提供する                 | ◯      |
| mod_mime_magic.so          |           |                                                                                     |         |
| mod_mpm_event.so           |           |                                                                                     | ◯      |
| mod_mpm_prefork.so         |           |                                                                                     | △      |
| mod_mpm_worker.so          |           |                                                                                     | △      |
| mod_negotiation.so         |           |                                                                                     |         |
| mod_proxy.so               |           |                                                                                     | ◯      |
| mod_proxy_ajp.so           |           |                                                                                     |         |
| mod_proxy_balancer.so      |           |                                                                                     |         |
| mod_proxy_connect.so       |           |                                                                                     |         |
| mod_proxy_express.so       |           |                                                                                     |         |
| mod_proxy_fcgi.so          |           |                                                                                     |         |
| mod_proxy_fdpass.so        |           |                                                                                     |         |
| mod_proxy_ftp.so           |           |                                                                                     | x       |
| mod_proxy_http.so          |           |                                                                                     | ◯      |
| mod_proxy_scgi.so          |           |                                                                                     |         |
| mod_proxy_wstunnel.so      |           |                                                                                     |         |
| mod_ratelimit.so           |           |                                                                                     | x       |
| mod_reflector.so           |           |                                                                                     | x       |
| mod_remoteip.so            |           |                                                                                     |         |
| mod_reqtimeout.so          |           |                                                                                     |         |
| mod_request.so             |           |                                                                                     | x       |
| mod_rewrite.so             |           |                                                                                     | ◯      |
| mod_sed.so                 |           |                                                                                     | x       |
| mod_setenvif.so            |           |                                                                                     |         |
| mod_slotmem_plain.so       |           |                                                                                     |         |
| mod_slotmem_shm.so         |           |                                                                                     |         |
| mod_socache_dbm.so         |           |                                                                                     |         |
| mod_socache_memcache.so    |           |                                                                                     |         |
| mod_socache_shmcb.so       |           |                                                                                     |         |
| mod_speling.so             |           |                                                                                     | x       |
| mod_status.so              |           | サーバの稼働状況と性能情報を提供する                                                | ◯      |
| mod_substitute.so          |           |                                                                                     |         |
| mod_suexec.so              |           |                                                                                     |         |
| mod_systemd.so             |           |                                                                                     | △      |
| mod_unique_id.so           |           |                                                                                     |         |
| mod_unixd.so               |           |                                                                                     |         |
| mod_userdir.so             |           |                                                                                     | x       |
| mod_usertrack.so           |           |                                                                                     | x       |
| mod_version.so             |           |                                                                                     |         |
| mod_vhost_alias.so         |           |                                                                                     |         |
| mod_watchdog.so            |           | 他のモジュールに定期的にタスクを実行するインフラを提供するモジュール。              | x       |
|----------------------------+-----------+-------------------------------------------------------------------------------------+---------|
[1] Apache必要最小限構成で必須とするモジュール

エラーページ一覧
|-------------+----------------------------------------+------|
| HTTP_STATUS | エラーページファイル名                 | 説明 |
|-------------+----------------------------------------+------|
|             | HTTP_BAD_GATEWAY.html.var              |      |
|             | HTTP_BAD_REQUEST.html.var              |      |
| 403         | HTTP_FORBIDDEN.html.var                |      |
|             | HTTP_GONE.html.var                     |      |
|             | HTTP_INTERNAL_SERVER_ERROR.html.var    |      |
|             | HTTP_LENGTH_REQUIRED.html.var          |      |
|             | HTTP_METHOD_NOT_ALLOWED.html.var       |      |
| 404         | HTTP_NOT_FOUND.html.var                |      |
|             | HTTP_NOT_IMPLEMENTED.html.var          |      |
|             | HTTP_PRECONDITION_FAILED.html.var      |      |
|             | HTTP_REQUEST_ENTITY_TOO_LARGE.html.var |      |
|             | HTTP_REQUEST_TIME_OUT.html.var         |      |
|             | HTTP_REQUEST_URI_TOO_LARGE.html.var    |      |
|             | HTTP_SERVICE_UNAVAILABLE.html.var      |      |
|             | HTTP_UNAUTHORIZED.html.var             |      |
|             | HTTP_UNSUPPORTED_MEDIA_TYPE.html.var   |      |
|             | HTTP_VARIANT_ALSO_VARIES.html.var      |      |
|-------------+----------------------------------------+------|

* セキュア対応
** 不要なモジュール除外
#+begin_example
# 全モジュールロード定義をコメントアウトする
# Include conf.modules.d/*.conf

# 必要な部分だけロードするようにする
Include conf.modules.d/00-base.conf
Include conf.modules.d/00-mpm.conf
Include conf.modules.d/00-proxy.conf
Include conf.modules.d/00-systemd.conf
#+end_example

また各個別ファイルから利用しないモジュールを無効化する。
最小限のモジュール一覧は表「初期インストールされたモジュール一覧」を参照する。

** cgi機能無効化
- =/cgi-bin/= アリアス定義をコメントアウト
#+begin_example
<IfModule alias_module>
    # ---- cgi無効化する
    # ScriptAlias /cgi-bin/ "/var/www/cgi-bin/"
</IfModule>

#
# "/var/www/cgi-bin" should be changed to whatever your ScriptAliased
# CGI directory exists, if you have that configured.
#
# --- cgi無効化する
# <Directory "/var/www/cgi-bin">
#     AllowOverride None
#     Options None
#     Require all granted
# </Directory>
#+end_example

** 不要な設定ファイルを外す
=/etc/httpd/conf/httpd.conf= に =conf.d/= ディレクトリ配下の設定ファイルを読み込み部
分の定義を次のように変える。

#+begin_example

# 全てファイルの読み込みを無効化する
# IncludeOptional conf.d/*.conf

# 必要な設定ファイルのみを読み込み
IncludeOptional conf.d/autoindex.conf
#+end_example

conf.d配下にファイルを個別無効化する場合、次のように設定を行えればいいでしょう。

*** =/etc/httpd/conf.d/userdir.conf=
ホームディレクトリにpublic_htmlのコンテンツを簡単に公開するための機能です。必須機能で
ないので無効化する。デフォルトでは =UserDir disabled= で機能無効化しているのでそのま
までもいいですが、完全無効化するには以下の対応が必要です。

- モジュール自体をロードしないこと
- =/home/*/public_html= ディレクトリへのアクセス定義を無効化する

=/etc/httpd/conf.modules.d/00-base.conf= ファイルにモジュールロードをコメントアウトす
る
#+begin_example
★コメントアウトする
## LoadModule userdir_module modules/mod_userdir.so
#+end_example

=/etc/httpd/conf.d/userdir.conf= にディレクトリへのアクセス定義を無効化する
#+begin_example
# <Directory "/home/*/public_html">
#     AllowOverride FileInfo AuthConfig Limit Indexes
#     Options MultiViews Indexes SymLinksIfOwnerMatch IncludesNoExec
#     Require method GET POST OPTIONS
# </Directory>
#+end_example

*** =/etc/httpd/conf.d/manual.conf=
Apacheマニュアルコンテンツ公開用設定ファイル、これも不要です。
ファイルの内容をコメントアウトしてもいいですし、ファイル自体を削除や移動でも問題なし。

*** =/etc/httpd/conf.d/welcome.conf=
indexページが存在しない場合、 =/usr/share/httpd/noindex/index.html= CentOSディストリ
ビューション向けのトップページを表示する処理を果たしている設定ファイル。

不要なので、このファイル内の内容を全部コメントアウトすることで無効化する。ファイル移動
や削除で対応する場合、バージョン更新時に復活するのでコメントアウト方式の方が良いでで
しょう。

*** =/etc/httpd/conf.d/autoindex.conf=


{{{more}}}

** 起動ユーザ・グループ設定
特権ポート =80= ポートでの待ち受けが必要なため、起動時に =root= ユーザで実施する。但
しそのままrootユーザで継続稼働するとセキュリティ上問題があるため、 =httpd.conf= にポー
ト受け待ち処理完了後後続の処理を別のユーザに切り替える設定ができる。
デフォルトは =apache= ユーザ・グループですので、このまましておく。
#+begin_example
User apache
Group apache
#+end_example

** サーバ情報の隠蔽やTRACEメソッドの禁止
=/etc/httpd/conf.d/httpd-default.conf= ファイルに次の設定を加える。
#+begin_example
# HTTPレスポンスヘッダに出力されるサーバ署名の設定
ServerTokens Prod

# エラー画面のフッターにサーバ情報を最小限に抑える
ServerSignature Off

# TRACEメソッドの禁止
TraceEnable Off
#+end_example
=httpd-default.conf= ファイルが存在しない場合、テンプレートからコピーしましょう。
#+begin_example
$ sudo cp /usr/share/doc/httpd-2.4.6/httpd-default.conf /etc/httpd/conf.d/
#+end_example
=ServerTokens= の設定効果を確認する
#+begin_example
★設定前
$ curl -v http://127.0.0.1/
* About to connect() to 127.0.0.1 port 80 (#0)
*   Trying 127.0.0.1...
* Connected to 127.0.0.1 (127.0.0.1) port 80 (#0)
> GET / HTTP/1.1
> User-Agent: curl/7.29.0
> Host: 127.0.0.1
> Accept: */*
> 
< HTTP/1.1 200 OK
< Date: Mon, 29 Sep 2014 06:49:14 GMT
< Server: Apache/2.4.6 (CentOS)     ★ここにバージョン情報が出ている
< Last-Modified: Sun, 28 Sep 2014 13:59:24 GMT
< ETag: "d-504208ec5765c"
< Accept-Ranges: bytes
< Content-Length: 13
< Connection: close
< Content-Type: text/html; charset=UTF-8
< 
hello world!
* Closing connection 0

★設定後
$ curl -v http://127.0.0.1/
* About to connect() to 127.0.0.1 port 80 (#0)
*   Trying 127.0.0.1...
* Connected to 127.0.0.1 (127.0.0.1) port 80 (#0)
> GET / HTTP/1.1
> User-Agent: curl/7.29.0
> Host: 127.0.0.1
> Accept: */*
> 
< HTTP/1.1 200 OK
< Date: Mon, 29 Sep 2014 06:51:29 GMT
< Server: Apache          ★バージョン情報やOS情報が消えた
< Last-Modified: Sun, 28 Sep 2014 13:59:24 GMT
< ETag: "d-504208ec5765c"
< Accept-Ranges: bytes
< Content-Length: 13
< Connection: close
< Content-Type: text/html; charset=UTF-8
< 
hello world!
* Closing connection 0
#+end_example
=ServerSignature= の設定効果を確認する
#+begin_example
$ curl -v -H 'Accept-Language: ja-JP;' -v http://127.0.0.1/xxx
#+end_example
** ルートコンテンツへアクセス制限

デフォルトルートコンテンツへアクセスをすべて拒否する
#+begin_example
<Directory "/var/www/html">
    # Options Indexes FollowSymLinks
    # ★Options設定を改善する、念の為
    Options SymLinksIfOwnerMatch

    # .htaccess設定上書きを無効化する
    AllowOverride None

    # Require all granted
    # ★すべてのアクセスを拒否する
    Require all denied
</Directory>
#+end_example

- Indexes

- SymLinksIfOwnerMatch

意図しないファイルがHTTPによって公開されることを防ぐため、リンク元とリンク先のオーナーが一致したときだけシンボリックリンクを許可するように設定する。

** HTTPリクエストの制限
- LimitRequestBody
  不必要に大きなサイズのファイルをアップロードされることによるレスポンス遅延を防ぐため、クライアントから送られるHTTPリクエストのボディの総量を制限する。

- LimitRequestFieldSize

- LimitRequestLine

- LimitXMLRequestBody

* 性能や運用のための設定
** 言語設定
Content-Typに言語の自動付与を無効化する
=httpd.conf=
#+begin_example
# charset が記述されていなかった場合に charset を自動的に付加する                                      |
# デフォルトの文字コードの設定は行わない                                                               |
AddDefaultCharset Off
#+end_example

=httpd-languages.conf=
#+begin_example

★必要な言語のみ有効にする
# AddLanguage ca .ca
# AddLanguage cs .cz .cs
# AddLanguage da .dk
# AddLanguage de .de
# AddLanguage el .el
AddLanguage en .en
# AddLanguage eo .eo
# AddLanguage es .es
# AddLanguage et .et
# AddLanguage fr .fr
# AddLanguage he .he
# AddLanguage hr .hr
# AddLanguage it .it
AddLanguage ja .ja
AddLanguage ko .ko
# AddLanguage ltz .ltz
# AddLanguage nl .nl
# AddLanguage nn .nn
# AddLanguage no .no
# AddLanguage pl .po
# AddLanguage pt .pt
# AddLanguage pt-BR .pt-br
# AddLanguage ru .ru
# AddLanguage sv .sv
# AddLanguage tr .tr
AddLanguage zh-CN .zh-cn
AddLanguage zh-TW .zh-tw

★優先順位を見直す
LanguagePriority jp zh-CN zh-TW en ko
#+end_example

言語の詳細設定は
http://www.asahi-net.or.jp/~aa4t-nngk/apache2.html
の「言語設定と文字化け」が参考になります。

** ログ出力設定
障害解析のために、アクセスログに実行プロセスのID(%P)とコネクションの接続状況(%X)を表示する。また、稼働統計を取得するために、アクセスログに応答時間(%D)を表示する。

** DNS問い合わせ
DNS問合せは主にアクセスログにクライアントのドメイン名を記録するに使われる。
DNS問合せに性能劣化の影響があるため、DNS問い合わせを無効とする。
=httpd-default.conf=
#+begin_example
# 性能優先でDNS問い合わせを無効化
HostnameLookups Off
#+end_example

** 流量制御
- MPMの設定
- 接続バックログ
- KeepAliveの設定

** タイムアウト設定
** その他

- EnableMMAP
- EnableSendfile

* 参考
http://www.asahi-net.or.jp/~aa4t-nngk/apache.html
