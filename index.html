
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="ja"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Akira's Tech Notes</title>
  <meta name="author" content="luozengbin">

  
  <meta name="description" content="Table of Contents 1. CodeCacheによる性能劣化事例
2. CodeCacheについて
3. CodeCache使用状況の確認方法 3.1. JVM Printフラグで確認する
3.2. JConsoleからの確認方法
3.3. VisualVMからのからの確認方法
3 &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://luozengbin.github.io/index.html">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Akira's Tech Notes" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
  <!-- fixgist -->
  <script type="text/javascript" src="/javascripts/custom/fixgist.js"></script>
  
  <!-- fancybox -->
  <script type="text/javascript" src="/javascripts/fancybox/jquery.fancybox.js?v=2.1.5"></script>
  <script type="text/javascript" src="/javascripts/custom/fancybox_hooks.js"></script>
  <link rel="stylesheet" type="text/css" href="/javascripts/fancybox/jquery.fancybox.css?v=2.1.5" media="screen" />

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-34369831-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <div style="float:left;">
    <h1><a href="/">Akira's Tech Notes</a></h1>
    
    <h2 class="custom1">Java/JVM | GNU/Linux | Emacs/Lisp | 知的好奇心駆動</h2>
    
  </div>
  <div id="headericon" style="float:right;">
    <img src="/images/headericon.png" alt="header-icon" height="100" width="100"/>
  </div>
  <div id="subtitle2" style="clear:both;">
    <span class="subtitle2">ネイティブでない日本語で思い付くことや気になることをダラダラ書く、体裁とかは気にしない。読みづらいと感じた時に随時更新する。</span>
  </div>

  <script type="text/javascript">
     var _ua = (function(u){
      return {
        Tablet:(u.indexOf("windows") != -1 && u.indexOf("touch") != -1)
          || u.indexOf("ipad") != -1
          || (u.indexOf("android") != -1 && u.indexOf("mobile") == -1)
          || (u.indexOf("firefox") != -1 && u.indexOf("tablet") != -1)
          || u.indexOf("kindle") != -1
          || u.indexOf("silk") != -1
          || u.indexOf("playbook") != -1,
        Mobile:(u.indexOf("windows") != -1 && u.indexOf("phone") != -1)
          || u.indexOf("iphone") != -1
          || u.indexOf("ipod") != -1
          || (u.indexOf("android") != -1 && u.indexOf("mobile") != -1)
          || (u.indexOf("firefox") != -1 && u.indexOf("mobile") != -1)
          || u.indexOf("blackberry") != -1
      }
      })(window.navigator.userAgent.toLowerCase());

      if(_ua.Mobile){
          var element = document.getElementById("headericon");
          element.style.display = 'none';
      }
  </script>
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:luozengbin.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/blog/about.html">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015-09-01-%5Btips%5D%5Bjava%5Dcodecache%E9%A0%98%E5%9F%9F%E4%BD%BF%E7%94%A8%E7%8A%B6%E6%B3%81%E3%81%AE%E7%A2%BA%E8%AA%8D%E6%96%B9%E6%B3%95.html">[tips][Java]CodeCache領域使用状況の確認方法</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-09-01T00:00:00+09:00" pubdate data-updated="true">2015-09-01 (Tue)</time>
        
      </p>
    
  </header>


  <div class="entry-content"><div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="/blog/2015-09-01-%5Btips%5D%5Bjava%5Dcodecache%E9%A0%98%E5%9F%9F%E4%BD%BF%E7%94%A8%E7%8A%B6%E6%B3%81%E3%81%AE%E7%A2%BA%E8%AA%8D%E6%96%B9%E6%B3%95.html#orgheadline1">1. CodeCacheによる性能劣化事例</a></li>
<li><a href="/blog/2015-09-01-%5Btips%5D%5Bjava%5Dcodecache%E9%A0%98%E5%9F%9F%E4%BD%BF%E7%94%A8%E7%8A%B6%E6%B3%81%E3%81%AE%E7%A2%BA%E8%AA%8D%E6%96%B9%E6%B3%95.html#orgheadline2">2. CodeCacheについて</a></li>
<li><a href="/blog/2015-09-01-%5Btips%5D%5Bjava%5Dcodecache%E9%A0%98%E5%9F%9F%E4%BD%BF%E7%94%A8%E7%8A%B6%E6%B3%81%E3%81%AE%E7%A2%BA%E8%AA%8D%E6%96%B9%E6%B3%95.html#orgheadline7">3. CodeCache使用状況の確認方法</a>
<ul>
<li><a href="/blog/2015-09-01-%5Btips%5D%5Bjava%5Dcodecache%E9%A0%98%E5%9F%9F%E4%BD%BF%E7%94%A8%E7%8A%B6%E6%B3%81%E3%81%AE%E7%A2%BA%E8%AA%8D%E6%96%B9%E6%B3%95.html#orgheadline3">3.1. JVM Printフラグで確認する</a></li>
<li><a href="/blog/2015-09-01-%5Btips%5D%5Bjava%5Dcodecache%E9%A0%98%E5%9F%9F%E4%BD%BF%E7%94%A8%E7%8A%B6%E6%B3%81%E3%81%AE%E7%A2%BA%E8%AA%8D%E6%96%B9%E6%B3%95.html#orgheadline4">3.2. JConsoleからの確認方法</a></li>
<li><a href="/blog/2015-09-01-%5Btips%5D%5Bjava%5Dcodecache%E9%A0%98%E5%9F%9F%E4%BD%BF%E7%94%A8%E7%8A%B6%E6%B3%81%E3%81%AE%E7%A2%BA%E8%AA%8D%E6%96%B9%E6%B3%95.html#orgheadline5">3.3. VisualVMからのからの確認方法</a></li>
<li><a href="/blog/2015-09-01-%5Btips%5D%5Bjava%5Dcodecache%E9%A0%98%E5%9F%9F%E4%BD%BF%E7%94%A8%E7%8A%B6%E6%B3%81%E3%81%AE%E7%A2%BA%E8%AA%8D%E6%96%B9%E6%B3%95.html#orgheadline6">3.4. Java8のNTM(Native Memory Tracking)で確認する</a></li>
</ul>
</li>
<li><a href="/blog/2015-09-01-%5Btips%5D%5Bjava%5Dcodecache%E9%A0%98%E5%9F%9F%E4%BD%BF%E7%94%A8%E7%8A%B6%E6%B3%81%E3%81%AE%E7%A2%BA%E8%AA%8D%E6%96%B9%E6%B3%95.html#orgheadline8">4. CodeCahe溢れた時の出力</a></li>
<li><a href="/blog/2015-09-01-%5Btips%5D%5Bjava%5Dcodecache%E9%A0%98%E5%9F%9F%E4%BD%BF%E7%94%A8%E7%8A%B6%E6%B3%81%E3%81%AE%E7%A2%BA%E8%AA%8D%E6%96%B9%E6%B3%95.html#orgheadline9">5. CodeCahe溢れた時の対応</a></li>
<li><a href="/blog/2015-09-01-%5Btips%5D%5Bjava%5Dcodecache%E9%A0%98%E5%9F%9F%E4%BD%BF%E7%94%A8%E7%8A%B6%E6%B3%81%E3%81%AE%E7%A2%BA%E8%AA%8D%E6%96%B9%E6%B3%95.html#orgheadline10">6. 参考</a></li>
</ul>
</div>
</div>

<div id="outline-container-orgheadline1" class="outline-2">
<h2 id="orgheadline1"><span class="section-number-2">1</span> CodeCacheによる性能劣化事例</h2>
<div class="outline-text-2" id="text-1">
<p>
先日CodeCacheによる性能問題が発生した、原因を突き止めるには時間が掛かりました。
そのわけは
</p>

<ol class="org-ol">
<li>全体が遅いではなく、一部処理のみ遅い</li>
<li>スレッドダンプから遅い箇所の特定が出来ない</li>
<li>プロファイリングからホットメソットの特定が出来ない</li>
<li>性能劣化時間帯に同期化によるロック待ちが発生していない</li>
<li>性能劣化時間帯のシステムコールのコストは平常時と変わらない</li>
<li>性能劣化時間帯にメジャーGCが起きていない、マイナーGCの時間も正常数値範囲ないである</li>
</ol>

<p>
よく言われているJVM性能に影響する要素を一通り確認しても、問題の特出が出来なかった。
</p>

<p>
今回の障害ケースは以下のような特徴があります。
</p>

<ul class="org-ul">
<li>アプリケーションサーバ一定時間運転後、特定画面の処理時間が数十倍伸びる</li>
<li>アプリケーション再デプロイ後、スローダウン現象が起きやすくなる傾向がある</li>
<li>一度性能劣化すると、アプリケーションサーバを再起動しないと回復しない</li>
</ul>

<p>
この現象はメモリリークによるGC時間が伸びるのような性能劣化ケースと似ている。
しかしGCによるスローダウンは波があるはず、かつ特定画面が遅いとは限らないでしょう。
つまり、CodeCacheによる性能劣化は原因を気づきにくい場合があります。
最終的Flight RecorderのJITコンパイラー記録から問題がCodeCacheにあることを推測した。
OpenJDKご使用の場合 <code>-XX:+PrintCompilation</code> JVM起動フラグでJITコンパイルログから同
じことも確認できる。
</p>

<p>
<span class="underline">スローダウン前に取れた記録</span>
</p>


<div class="figure">
<p><img src="blog/img/20150901_codecache_jfr_1.png" alt="20150901_codecache_jfr_1.png" />
</p>
</div>

<p>
<span class="underline">性能劣化時間帯で取れた記録</span>
</p>


<div class="figure">
<p><img src="blog/img/20150901_codecahce_jfr_2.png" alt="20150901_codecahce_jfr_2.png" />
</p>
</div>

<p>
ご覧の通り、性能劣化時間帯にJITコンパイラーが動いていないようだ。
CodeCache領域の使用量を確認すると、空きがないことも確認されました。
ここで問題はCodeCacheが足りないと推測出来るでしょう。ただ単に推測に過ぎないので、
根拠付けるためにテスト用アプリケーションをデプロイしてJITコンパイラーの挙動を確認しました。
やはりJITコンパイラーが動いていないのだ。
</p>
</div>
</div>

<div id="outline-container-orgheadline2" class="outline-2">
<h2 id="orgheadline2"><span class="section-number-2">2</span> CodeCacheについて</h2>
<div class="outline-text-2" id="text-2">
<p>
CodeCacheについてJava Magazineに <a href="https://twitter.com/kittylyst">BEN EVANS</a> さんの記事が分かりやすいと思います。
</p>

<ul class="org-ul">
<li><a href="http://www.oracle.com/webfolder/technetwork/jp/javamagazine/Java-JA13-Architect-evans.pdf">Java HotSpot VM コード・キャッシュについて</a></li>
<li><a href="http://www.oracle.com/webfolder/technetwork/jp/javamagazine/Java-MJ12-architect.pdf">Java HotSpot VMにおけるJITコンパイルの概要</a></li>
<li><a href="http://www.oracle.com/webfolder/technetwork/jp/javamagazine/Java-SO12-Architect-evans.pdf">Java HotSpot VMの内部を探る(2): パフォーマンス解析のための統計情報</a></li>
<li><a href="http://www.oracle.com/webfolder/technetwork/jp/javamagazine/Java-JA14-Architect-Evans.pdf">JITWatchを使用したJava JITコンパイルの理解</a></li>
</ul>

<p>
以下は自分のまとめです。
</p>

<ul class="org-ul">
<li>JITコンパイラーの結果がCodeCacheに格納される</li>
<li>CodeCacheが一杯になるとJITコンパイラーが停止してしまう</li>
<li>JITコンパイラーが停止すると性能が劣化する（事例: 本来6秒で終わる処理が40秒かかる）</li>
<li>アプリを振り返し再デプロイするとCodeCache領域が溢れる可能性がある</li>
<li>SpringやJPAのような実行時にClassを動的生成するアプリに置いてCodeCache領域を大量に消費する場合がある</li>
<li>JDK7で階層型コンパイラーを有効化するとCodeCache領域の消費が増加する</li>
<li>ミドルウェア／アプリケーションサーバのCodeCache領域をチューニングすべき</li>
<li>ミドルウェア／アプリケーションサーバのCodeCache領域常時監視しておくべき</li>
</ul>

<p>
</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2015-09-01-%5Btips%5D%5Bjava%5Dcodecache%E9%A0%98%E5%9F%9F%E4%BD%BF%E7%94%A8%E7%8A%B6%E6%B3%81%E3%81%AE%E7%A2%BA%E8%AA%8D%E6%96%B9%E6%B3%95.html">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015-08-30-%5Bjava%E9%81%93%E5%85%B7%5Djstat--gc%E3%81%AE%E5%87%BA%E5%8A%9B%E3%82%92%E8%A6%8B%E3%82%84%E3%81%99%E3%81%8F%E3%81%99%E3%82%8B.html">[Java道具]jstat -gcの出力を見やすくする</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-08-30T00:00:00+09:00" pubdate data-updated="true">2015-08-30 (Sun)</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>
<code>jstat -gc</code> でJVMのメモリ使用状況を確認する際によく使うのですが、少し見づらいと感じま
したので、整形用のオレオレスクリプトを作成しました。
</p>

<p>
jstat出力見づらい要因として
</p>
<ul class="org-ul">
<li>出力単位がbyteとなっています、数字長い時目視でメガバイト(mb)への換算が大変</li>
<li>ヘッダ行と値行がズレる時があります</li>
</ul>

<p>
デフォルトの出力形式は以下の通り
</p>
<pre class="example">
$ jstat -gc 10901
 S0C    S1C    S0U    S1U      EC       EU        OC         OU       MC     MU    CCSC   CCSU   YGC     YGCT    FGC    FGCT     GCT
55296.0 55296.0  0.0    0.0   334336.0 157179.1  890368.0   23266.0   35748.0 32020.9 5248.0 4068.9      3    0.124   2      0.195    0.320
</pre>

<p>
次は自作スクリプトで整形後の出力形式(JDK8の場合)
</p>
<pre class="example">
---------------------------------------------
S0  領域 |   54.00 /    0.00 (MB)  |  0.00%
S1  領域 |   54.00 /    0.00 (MB)  |  0.00%
Eden領域 |  326.50 /  170.63 (MB)  | 52.26%
Old 領域 |   22.72 /  869.50 (MB)  |  2.61%
Meta領域 |   31.27 /   34.91 (MB)  | 89.57%
CCPS領域 |    3.97 /   54.00 (MB)  | 77.53%
---------------------------------------------
YGC 回数 |       3 回
YGC 時間 |    0.12 秒
FGC 回数 |       2 回
FGC 時間 |    0.20 秒
---------------------------------------------
</pre>

<p>
コードはgithubに公開しています。
</p>

<p>
<a href="https://github.com/luozengbin/misc-box/blob/master/jvm_memstst.sh">jvm_memstst.sh</a>
</p>


<script src="https://gist.github.com/luozengbin/52d1359f89e88654e6ec.js"></script>
<script src="/javascripts/custom/fixgist.js"></script>

<p>
出力加工機能以外、次の便利な機能も提供しています。
</p>
<ul class="org-ul">
<li>JavaプロセスID自動特定する</li>
<li>JAVA_HOMEを自動的に特定する</li>
</ul>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015-08-29-%5Btips%5D%5Blinux%5D%E6%97%A7%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3centos%E3%81%A7yum%E6%9B%B4%E6%96%B0%E3%81%A7%E3%81%8D%E3%81%AA%E3%81%8F%E3%81%AA%E3%81%A3%E3%81%9F%E6%99%82.html">[tips][Linux]旧バージョンCentOSでyum更新できなくなった時</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-08-29T00:00:00+09:00" pubdate data-updated="true">2015-08-29 (Sat)</time>
        
      </p>
    
  </header>


  <div class="entry-content"><div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="/blog/2015-08-29-%5Btips%5D%5Blinux%5D%E6%97%A7%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3centos%E3%81%A7yum%E6%9B%B4%E6%96%B0%E3%81%A7%E3%81%8D%E3%81%AA%E3%81%8F%E3%81%AA%E3%81%A3%E3%81%9F%E6%99%82.html#orgheadline1">1. CentOS 6.6でyum更新したら404エラー</a></li>
<li><a href="/blog/2015-08-29-%5Btips%5D%5Blinux%5D%E6%97%A7%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3centos%E3%81%A7yum%E6%9B%B4%E6%96%B0%E3%81%A7%E3%81%8D%E3%81%AA%E3%81%8F%E3%81%AA%E3%81%A3%E3%81%9F%E6%99%82.html#orgheadline2">2. 参考</a></li>
</ul>
</div>
</div>

<div id="outline-container-orgheadline1" class="outline-2">
<h2 id="orgheadline1"><span class="section-number-2">1</span> CentOS 6.6でyum更新したら404エラー</h2>
<div class="outline-text-2" id="text-1">
<p>
CentOS 6.6でyum更新したら404エラーとなって更新できなくなった。
</p>
<pre class="example">
# yum update
読み込んだプラグイン:fastestmirror
更新処理の設定をしています
Loading mirror speeds from cached hostfile
 * base: ftp.iij.ad.jp
 * extras: ftp.iij.ad.jp
 * updates: centos.usonyx.net
http://ftp.iij.ad.jp/pub/linux/centos/6.6/os/x86_64/repodata/repomd.xml: [Errno 14] PYCURL ERROR 22 - "The requested URL returned error: 404 Not Found"
他のミラーを試します。
http://ftp.jaist.ac.jp/pub/Linux/CentOS/6.6/os/x86_64/repodata/repomd.xml: [Errno 14] PYCURL ERROR 22 - "The requested URL returned error: 404 Not Found"
他のミラーを試します。
http://ftp.nara.wide.ad.jp/pub/Linux/centos/6.6/os/x86_64/repodata/repomd.xml: [Errno 14] PYCURL ERROR 22 - "The requested URL returned error: 404 Not Found"
他のミラーを試します。
http://ftp.riken.jp/Linux/centos/6.6/os/x86_64/repodata/repomd.xml: [Errno 14] PYCURL ERROR 22 - "The requested URL returned error: 404 Not Found"
他のミラーを試します。
</pre>

<p>
ブラウザからミラーサイトを直接確認するとreadmeファイルしかありませんでした。
</p>


<div class="figure">
<p><img src="blog/img/20150829231548_CentOS_yum_404.png" alt="20150829231548_CentOS_yum_404.png" />
</p>
</div>

<p>
readmeの内容は下記となります。
</p>

<pre class="example">
$ curl http://ftp.iij.ad.jp/pub/linux/centos/6.6/readme
This directory (and version of CentOS) is deprecated.  For normal users,
you should use /6/ and not /6.6/ in your path. Please see this FAQ
concerning the CentOS release scheme:

https://wiki.centos.org/FAQ/General

If you know what you are doing, and absolutely want to remain at the 6.6
level, go to http://vault.centos.org/ for packages.

Please keep in mind that 6.0, 6.1, 6.2, 6.3, 6.4 , 6.5 and 6.6 no longer gets any updates, nor
any security fix's.
</pre>

<p>
簡単に言うと更新が止まった旧バージョンのパッケージは <code>http://vault.centos.org/</code>
ドメイン下に移管された。
</p>

<p>
というわけでyumリポジトリのURLを書き換えれば問題が解消される。
</p>

<pre class="example">
$ sudo sed -i -e "s|mirror\.centos\.org/centos/\$releasever|vault\.centos\.org/6.6|g" /etc/yum.repos.d/CentOS-Base.repo
$ sudo sed -i -e "s|#baseurl=|baseurl=|g" CentOS-Base.repo
$ sudo sed -i -e "s|mirrorlist=|#mirrorlist=|g" CentOS-Base.repo
#  yum update
読み込んだプラグイン:fastestmirror
更新処理の設定をしています
Loading mirror speeds from cached hostfile
base                                                                                                                                   | 3.7 kB     00:00     
extras                                                                                                                                 | 3.4 kB     00:00     
updates                                                                                                                                | 3.4 kB     00:00     
（中略）
</pre>
</div>
</div>

<div id="outline-container-orgheadline2" class="outline-2">
<h2 id="orgheadline2"><span class="section-number-2">2</span> 参考</h2>
<div class="outline-text-2" id="text-2">
<ul class="org-ul">
<li><a href="http://www.linuxask.com/questions/yum-repository-mirror-for-old-centos-versions">Yum repository mirror for old CentOS’ versions</a></li>
</ul>
</div>
</div>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015-08-29-%5Btips%5D%5Bjava%5Dopenjdk8%E4%BB%98%E5%B1%9E%E3%83%84%E3%83%BC%E3%83%AB%E5%AE%9F%E8%A1%8C%E6%99%82%E3%82%A8%E3%83%A9%E3%83%BC%E3%81%AE%E5%AF%BE%E7%AD%96.html">[tips][Java]OpenJDK8付属ツール実行時エラーの対策</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-08-29T00:00:00+09:00" pubdate data-updated="true">2015-08-29 (Sat)</time>
        
      </p>
    
  </header>


  <div class="entry-content"><div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="/blog/2015-08-29-%5Btips%5D%5Bjava%5Dopenjdk8%E4%BB%98%E5%B1%9E%E3%83%84%E3%83%BC%E3%83%AB%E5%AE%9F%E8%A1%8C%E6%99%82%E3%82%A8%E3%83%A9%E3%83%BC%E3%81%AE%E5%AF%BE%E7%AD%96.html#orgheadline1">1. プロセスのアタッチ出来ない</a></li>
<li><a href="/blog/2015-08-29-%5Btips%5D%5Bjava%5Dopenjdk8%E4%BB%98%E5%B1%9E%E3%83%84%E3%83%BC%E3%83%AB%E5%AE%9F%E8%A1%8C%E6%99%82%E3%82%A8%E3%83%A9%E3%83%BC%E3%81%AE%E5%AF%BE%E7%AD%96.html#orgheadline2">2. Metadata does not appear to be polymorphic</a></li>
<li><a href="/blog/2015-08-29-%5Btips%5D%5Bjava%5Dopenjdk8%E4%BB%98%E5%B1%9E%E3%83%84%E3%83%BC%E3%83%AB%E5%AE%9F%E8%A1%8C%E6%99%82%E3%82%A8%E3%83%A9%E3%83%BC%E3%81%AE%E5%AF%BE%E7%AD%96.html#orgheadline3">3. unknown CollectedHeap type</a></li>
</ul>
</div>
</div>
<p>
本記事のOpenJDK障害は次の環境で確認しています。
</p>

<pre class="example">
$ java -version
openjdk version "1.8.0_60"
OpenJDK Runtime Environment (build 1.8.0_60-b24)
OpenJDK 64-Bit Server VM (build 25.60-b23, mixed mode)

$ uname -a
Linux mimi 4.1.6-1-ARCH #1 SMP PREEMPT Mon Aug 17 08:52:28 CEST 2015 x86_64 GNU/Linux
</pre>

<p>
</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2015-08-29-%5Btips%5D%5Bjava%5Dopenjdk8%E4%BB%98%E5%B1%9E%E3%83%84%E3%83%BC%E3%83%AB%E5%AE%9F%E8%A1%8C%E6%99%82%E3%82%A8%E3%83%A9%E3%83%BC%E3%81%AE%E5%AF%BE%E7%AD%96.html">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015-08-07-%5Btips%5D%5Blinux%5Dfirefox%E8%B5%B7%E5%8B%95%E6%99%82%E3%81%AB%E3%83%97%E3%83%AD%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E9%81%B8%E6%8A%9E%E5%87%BA%E6%9D%A5%E3%82%8B%E3%82%88%E3%81%86%E3%81%AB%E3%81%99%E3%82%8B.html">[tips][Linux]Firefox起動時にプロファイル選択出来るようにする</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-08-07T00:00:00+09:00" pubdate data-updated="true">2015-08-07 (Fri)</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>
Web開発でクリーンなブラウザテスト環境が必要とする場面が結構あります。
普段利用しているブラウザの設定をリセットやキャッシュクリアは平気に出来ないでしょう。
</p>

<p>
この問題はブラウザのマルチプロファイル機能を利用すればを解決する。
</p>

<p>
例えばFirefoxに <code>--new-instance</code> オプションを付けて起動時すると下記のようなプロファイ
ル選択ダイアログが表示されて、「Create Profile」で新しいプロファイルを持ちたFirefoxが
起動される。
</p>


<div class="figure">
<p><img src="blog/img/2015-08-07-firefox-new-instance.png" alt="2015-08-07-firefox-new-instance.png" />
</p>
</div>

<p>
自分の環境では下記のdesktopファイルを追加することでランチャーからいつも起動出来るよう
にしています。
</p>

<p>
<code>.local/share/applications/myfirefox.desktop</code>
</p>
<pre class="example">
[Desktop Entry]
Name=MyFirefox
GenericName=Web Browser
GenericName[ja]=ウェブ・ブラウザ
Comment[ja]=ウェブを閲覧します
Exec=firefox --new-instance %u
Terminal=false
Type=Application
Icon=firefox
Categories=Network;WebBrowser;
MimeType=text/html;text/xml;application/xhtml+xml;application/vnd.mozilla.xul+xml;text/mml;x-scheme-handler/http;x-scheme-handler/https;x-scheme-handler/ftp;
StartupNotify=true
Actions=NewTab;NewWindow;NewPrivateWindow;

[Desktop Action NewTab]
Name[ja]=新しいタブ

[Desktop Action NewWindow]
Name[ja]=新しいウィンドウ

[Desktop Action NewPrivateWindow]
Name[ja]=新しいプライベートウィンドウ
</pre>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015-08-02-%5Bmemo%5D%5Blinux%5Dbash%E7%92%B0%E5%A2%83%E3%81%ABpeco%E3%82%92%E5%B0%8E%E5%85%A5%E3%81%97%E3%81%BE%E3%81%97%E3%81%9F.html">[Memo][Linux]bash環境にpecoを導入しました</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-08-02T00:00:00+09:00" pubdate data-updated="true">2015-08-02 (Sun)</time>
        
      </p>
    
  </header>


  <div class="entry-content"><div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. peco で何か便利なのか</a></li>
<li><a href="#sec-2">2. 導入手順</a></li>
<li><a href="#sec-3">3. bash履歴の検索をpecoインタフェースにする</a></li>
<li><a href="#sec-4">4. pecoインタフェースのキーバンディングをカスタマイズする</a></li>
<li><a href="#sec-5">5. 参考</a></li>
</ul>
</div>
</div>
<p>
以前から <a href="https://github.com/mooz/percol">percol</a> の流行りに気になっていたが、python製のため導入が面倒さそうなので保留
しました。最近、percolを元にgolangで書かれたpecoが出てきて導入しやすくなったと感じて
手を入れました。
</p>

<p>
</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2015-08-02-%5Bmemo%5D%5Blinux%5Dbash%E7%92%B0%E5%A2%83%E3%81%ABpeco%E3%82%92%E5%B0%8E%E5%85%A5%E3%81%97%E3%81%BE%E3%81%97%E3%81%9F.html">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015-07-23-%5Btips%5D%5Blinux%5Dsamba%E3%83%A6%E3%83%BC%E3%82%B6%E3%81%AE%E3%83%91%E3%82%B9%E3%83%AF%E3%83%BC%E3%83%89%E5%A4%89%E6%9B%B4.html">[tips][Linux]Sambaユーザのパスワード変更</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-07-23T00:00:00+09:00" pubdate data-updated="true">2015-07-23 (Thu)</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>
普段はLinuxで作業しているけど、MS系のドキュメントメンテ作業はWindowsでやらざるを得な
いのでSambaでLinux側のコンテンツをWindowsに共有するようにしていました。
</p>

<p>
ところで先週Windows端末再セットアップしたため、Sambaサーバに接続時にパスワードが聞か
れた時が、すっかり忘れましたのでSamba側でパスワードリセットをしました。
</p>

<ul class="org-ul">
<li>パスワードリセットコマンド（ユーザ登録コマンドと一緒）
<pre class="example">
$ sudo pdbedit -a -u test001
new password:
retype new password:
</pre>
</li>

<li>ついにパスワード情報の格納先を確認しました
<pre class="example">
$ pdbedit -L
tdbsam_open: Failed to open/create TDB passwd [/var/lib/samba/private/passdb.tdb]
tdbsam_getsampwnam: failed to open /var/lib/samba/private/passdb.tdb!
User Search failed!
</pre>
</li>
</ul>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015-07-23-%5Btips%5D%5Blinux%5Ddocker%E3%81%AE%E3%83%97%E3%83%AD%E3%82%AD%E3%82%B7%E8%A8%AD%E5%AE%9A.html">[tips][Linux]Dockerのプロキシ設定</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-07-23T00:00:00+09:00" pubdate data-updated="true">2015-07-23 (Thu)</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>
基本は本家のドキュメントを見ろう！
</p>

<p>
<a href="https://docs.docker.com/articles/systemd/">https://docs.docker.com/articles/systemd/</a>
</p>

<p>
ここでは Acrh Linx で確認された手順を記録する。
</p>

<p>
社内はフォワードプロキシ経由で外と繋ぐなので、デフォルトでは通らない ;-(
</p>
<pre class="example">
$ docker search oraclelinux
Error response from daemon: Get https://index.docker.io/v1/search?q=oraclelinux: dial tcp 54.174.226.171:443: no route to host
</pre>

<p>
<code>/etc/systemd/system/&lt;サービスID&gt;.d/</code> 配下に環境変数の上書きファイルを定義し、サービ
スをリロードするだけです。
</p>
<pre class="example">
$ sudo mkdir /etc/systemd/system/docker.service.d
$ sudo touch /etc/systemd/system/docker.service.d/http-proxy.conf
$ sudo nano /etc/systemd/system/docker.service.d/http-proxy.conf
[Service]
Environment="HTTP_PROXY=http://*********************:8081"
Environment="HTTPS_PROXY=http://*********************:8081"
$ sudo systemctl daemon-reload
$ sudo systemctl restart docker
$ docker search oraclelinux
NAME                                      DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED
oraclelinux                               Oracle Linux is an open-source operating s...   46        [OK]       
oracle/oraclelinux                        Oracle Linux is an open-source operating s...   16                   [OK]
tvierling/oraclelinux                     Oracle Linux base images, yum-updated to l...   2                    [OK]
centminmod/oraclelinux65base              Oracle Linux 6.5 base 1.57GB image              1                    
avmiller/oraclelinux                      Personal Oracle Linux Test Images (Non-pro...   0                    
kiwenlau/oraclelinux                                                                      0                    
talberto/oraclelinux                                                                      0                    
ksasi/oraclelinux                                                                         0                    
saltfactory/oraclelinux                   Oracle Linux                                    0                    
arpagaus/oraclelinux                                                                      0                    
joseperez/oraclelinux-lamp                oraclelinux 7.0 con mariadb, apache y php.      0                    
jinyan/oraclelinux                        Oracle Linux 6.6                                0                    
hootjr/oraclelinux                                                                        0                    
poisoncreed/oraclelinux-base-with-httpd                                                   0                    
bdpzone/bdporaclelinux6                   Big Data Partnership Development Environme...   0                    [OK]
dyoung522/oracle-ruby                     OracleLinux running Ruby                        0                    [OK]
bdpzone/bdporaclelinux7                   Big Data Partnership Development Environme...   0                    [OK]
mlechner/oraclelinux7                     GIS tools on Oracle Linux 7                     0                    
tehmul/oraclelinux6-tc                    Oracle Linux 6+Oracle Server JRE 8+ Apache...   0                    
calaniz/oraclelinux                                                                       0                    
dyoung522/oraclelinux-dev                 OracleLinux with development environment        0                    [OK]
hedlund/oraclelinux                                                                       0                    [OK]
florentbenoit/oraclelinux-jdk7                                                            0                    [OK]
</pre>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015-07-15-%5Bemacs%5Dmew%E8%B5%B7%E5%8B%95%E6%99%82%E3%81%AB%E3%82%A2%E3%82%AB%E3%82%A6%E3%83%B3%E3%83%88%E3%81%AE%E9%81%B8%E6%8A%9E%E3%82%92%E5%87%BA%E6%9D%A5%E3%82%8B%E3%82%88%E3%81%86%E3%81%AB.html">[Emacs]mew起動時にアカウントの選択を出来るように</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-07-15T00:00:00+09:00" pubdate data-updated="true">2015-07-15 (Wed)</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>
久々のemacsネタです。
</p>

<p>
mewで複数メールアカウントで扱うときにSummary モードにおいて <code>C</code> で切り替えることが出
来るので非常に便利です。ただし、起動時にdefaultアカウントの選択機能が持っていないので、
mew-init-hookで拡張してみました。
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp"><span style="color: #888a85;">;; </span><span style="color: #888a85;">&#12450;&#12459;&#12454;&#12531;&#12488;1</span>
(setq my-mew-config-1
      (list
       '(proto                          <span style="color: #ad7fa8; font-style: italic;">"+"</span>)
       '(name                           <span style="color: #ad7fa8; font-style: italic;">"******"</span>)
       '(user                           <span style="color: #ad7fa8; font-style: italic;">"******"</span>)   <span style="color: #888a85;">; </span><span style="color: #888a85;">&#12513;&#12540;&#12523;&#12450;&#12489;&#12524;&#12473;&#12398;@&#12363;&#12425;&#24038;&#37096;&#20998;</span>
       '(mail-domain                    <span style="color: #ad7fa8; font-style: italic;">"******"</span>)   <span style="color: #888a85;">; </span><span style="color: #888a85;">&#12513;&#12540;&#12523;&#12450;&#12489;&#12524;&#12473;&#12398;@&#12363;&#12425;&#21491;&#37096;&#20998;</span>
       '(smtp-server                    <span style="color: #ad7fa8; font-style: italic;">"******"</span>)   <span style="color: #888a85;">; </span><span style="color: #888a85;">&#36865;&#20449;&#29992;&#12469;&#12540;&#12496;&#12450;&#12489;&#12524;&#12473;</span>
       '(smtp-port                      <span style="color: #ad7fa8; font-style: italic;">"1025"</span>)     <span style="color: #888a85;">;</span>
       '(smtp-user                      <span style="color: #ad7fa8; font-style: italic;">"******"</span>)   <span style="color: #888a85;">; </span><span style="color: #888a85;">&#36865;&#20449;&#29992;&#12518;&#12540;&#12470;id</span>
       '(pop-server                     <span style="color: #ad7fa8; font-style: italic;">"******"</span>)   <span style="color: #888a85;">; </span><span style="color: #888a85;">&#21463;&#20449;&#29992;&#12469;&#12540;&#12496;&#12450;&#12489;&#12524;&#12473;</span>
       '(pop-port                       <span style="color: #ad7fa8; font-style: italic;">"1110"</span>)     <span style="color: #888a85;">;</span>
       '(pop-user                       <span style="color: #ad7fa8; font-style: italic;">"******"</span>)   <span style="color: #888a85;">; </span><span style="color: #888a85;">&#21463;&#20449;&#29992;&#12518;&#12540;&#12470;id</span>
       '(pop-delete                     t)          <span style="color: #888a85;">; </span><span style="color: #888a85;">&#12513;&#12540;&#12523;&#21463;&#20449;&#24460;&#12469;&#12540;&#12496;&#12540;&#20596;&#12398;&#12513;&#12483;&#12475;&#12540;&#12472;&#12434;&#65303;&#26085;&#12434;&#20445;&#25345;&#12377;&#12427;</span>
       '(pop-auth                       pass)       <span style="color: #888a85;">; </span><span style="color: #888a85;">pop3 &#12391;&#21463;&#20449;&#26178;&#12398;&#35469;&#35388;&#26041;&#24335;&#12289;&#25351;&#23450;&#12375;&#12394;&#12356;&#22580;&#21512;&#12399;apop&#26041;&#24335;&#12364;&#20351;&#29992;&#12373;&#12428;&#12427;</span>
       '(pop-size                       0)          <span style="color: #888a85;">; </span><span style="color: #888a85;">&#12513;&#12540;&#12523;&#12398;&#19978;&#38480;&#12469;&#12452;&#12474;&#12290;0 &#12398;&#22580;&#21512;&#12399;&#19978;&#38480;&#12394;&#12375;&#12290;</span>
       '(pop-header-only                t)          <span style="color: #888a85;">; </span><span style="color: #888a85;">[c-u s]&#12391;&#12504;&#12483;&#12480;&#12398; &#12415;&#12398;&#12467;&#12500;&#12540;</span>
       '(dcc                            <span style="color: #ad7fa8; font-style: italic;">"******"</span>)   <span style="color: #888a85;">; </span><span style="color: #888a85;">&#36820;&#20449;&#26178;&#12395;&#33258;&#20998;&#12398;&#12450;&#12489;&#12524;&#12473;&#12434;dcc&#12395;&#20837;&#12428;&#12427;&#12289;dcc&#12399;&#36865;&#20449;&#12375;&#12383;&#12513;&#12540;&#12523;&#12398;&#12504;&#12483;&#12480;&#12540;&#12395;&#34920;&#31034;&#12373;&#12428;&#12394;&#12356;</span>
       '(fcc                            <span style="color: #ad7fa8; font-style: italic;">"+sent"</span>)    <span style="color: #888a85;">; </span><span style="color: #888a85;">&#36865;&#20449;&#12375;&#12383;&#12513;&#12540;&#12523;&#12398;&#20445;&#23384;&#20808;</span>
       '(smime-signer                   <span style="color: #ad7fa8; font-style: italic;">"******"</span>)   <span style="color: #888a85;">; </span><span style="color: #888a85;">&#38651;&#23376;&#32626;&#21517;&#12391;&#20351;&#29992;&#12377;&#12427;&#35388;&#26126;&#26360;id</span>
       '(protect-privacy-always         nil)
       '(privacy-method                 smime)      <span style="color: #888a85;">; </span><span style="color: #888a85;">&#38651;&#23376;&#32626;&#21517;&#12479;&#12452;&#12503;&#12398;&#25351;&#23450;</span>
       '(draft-privacy-method           smime)
       '(protect-privacy-always-type  smime-signature)
       ))

<span style="color: #888a85;">;; </span><span style="color: #888a85;">&#12450;&#12459;&#12454;&#12531;&#12488;2</span>
(setq my-mew-config-2
      (list
       '(proto                   <span style="color: #ad7fa8; font-style: italic;">"%"</span>)
       '(name                    <span style="color: #ad7fa8; font-style: italic;">"******"</span>)
       '(user                    <span style="color: #ad7fa8; font-style: italic;">"******"</span>)
       '(mail-domain             <span style="color: #ad7fa8; font-style: italic;">"gmail.com"</span>)
       '(dcc                     <span style="color: #ad7fa8; font-style: italic;">"*******@gmail.com"</span>)
       '(protect-privacy-always  nil)
       '(ssl-verify-level        0)
       <span style="color: #888a85;">;; </span><span style="color: #888a85;">smtp&#12469;&#12540;&#12496;&#12540;</span>
       '(smtp-user               <span style="color: #ad7fa8; font-style: italic;">"*******@gmail.com"</span>)
       '(smtp-auth               t)
       '(smtp-ssl                t)
       '(smtp-server             <span style="color: #ad7fa8; font-style: italic;">"smtp.gmail.com"</span>)
       '(smtp-ssl-port           <span style="color: #ad7fa8; font-style: italic;">"465"</span>)
       <span style="color: #888a85;">;; </span><span style="color: #888a85;">imap&#12434;&#20351;&#29992;&#12377;&#12427;&#22580;&#21512;</span>
       '(inbox-folder            <span style="color: #ad7fa8; font-style: italic;">"%gmail"</span>)
       '(imap-user               <span style="color: #ad7fa8; font-style: italic;">"******@gmail.com"</span>)
       '(imap-size               5242880) <span style="color: #888a85;">; </span><span style="color: #888a85;">5m&#20197;&#20869;&#21363;&#26178;&#21463;&#20449;&#12377;&#12427;</span>
       '(imap-auth               t)
       '(imap-ssl                t)
       '(imap-ssl-port           <span style="color: #ad7fa8; font-style: italic;">"993"</span>)
       '(imap-server             <span style="color: #ad7fa8; font-style: italic;">"imap.gmail.com"</span>)
       ))

<span style="color: #888a85;">;;; </span><span style="color: #888a85;">&#12450;&#12459;&#12454;&#12531;&#12488;3</span>
(setq my-mew-config-3
      (list
       '(proto                   <span style="color: #ad7fa8; font-style: italic;">"+"</span>)
       <span style="color: #888a85;">;; </span><span style="color: #888a85;">&#65288;&#20013;&#30053;&#65289;</span>
))

<span style="color: #888a85;">;;; </span><span style="color: #888a85;">&#12450;&#12459;&#12454;&#12531;&#12488;4</span>
(setq my-mew-config-4
      (list
       '(proto                   <span style="color: #ad7fa8; font-style: italic;">"+"</span>)
       <span style="color: #888a85;">;; </span><span style="color: #888a85;">&#65288;&#20013;&#30053;&#65289;</span>
))

(setq my-mew-account-list
      (list (append (list 'account1) my-mew-config-1)
            (append (list 'account2) my-mew-config-2)
            (append (list 'account3) my-mew-config-3)
            (append (list 'account4) my-mew-config-4)))

(<span style="color: #729fcf; font-weight: bold;">require</span> '<span style="color: #8ae234;">dash</span>)

<span style="color: #888a85;">;; </span><span style="color: #888a85;">&#12450;&#12459;&#12454;&#12531;&#12488;&#36984;&#25246;&#20966;&#29702;</span>
(<span style="color: #729fcf; font-weight: bold;">defun</span> <span style="color: #edd400; font-weight: bold;">my-mew-select-account</span> ()
  (<span style="color: #729fcf; font-weight: bold;">let*</span> ((account-name-list (mapcar (<span style="color: #729fcf; font-weight: bold;">lambda</span> (x) (pp-to-string (car x))) my-mew-account-list))
         (selected-account (completing-read <span style="color: #ad7fa8; font-style: italic;">"mew account: "</span> account-name-list nil t)))
    (message selected-account)
    (setq mew-config-alist
          (append
           (list
            (append (list 'default)
                    (cdr
                     (car (-filter (<span style="color: #729fcf; font-weight: bold;">lambda</span> (mew-config)
                                     (string= selected-account
                                              (pp-to-string (car mew-config))))
                                   my-mew-account-list)))))
           (-filter (<span style="color: #729fcf; font-weight: bold;">lambda</span> (mew-config)
                      (not
                       (string= selected-account
                                (pp-to-string (car mew-config)))))
                    my-mew-account-list)))))

<span style="color: #888a85;">;; </span><span style="color: #888a85;">&#36215;&#21205;&#26178;&#12395;&#36208;&#12425;&#12379;&#12427;</span>
(add-hook 'mew-init-hook 'my-mew-select-account)
</pre>
</div>

<p>
デモ
</p>
<video controls>
   <source src="/blog/video/2015-07-15_mew_account_select.mp4">
</video>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015-07-02-%5B%E5%B0%8F%E9%81%93%E5%85%B7%5D%5Bjava%5D%E3%82%B9%E3%82%BF%E3%83%83%E3%82%AF%E3%82%B5%E3%82%A4%E3%82%BA%E7%9B%A3%E8%A6%96%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88.html">[小道具][Java]スタックサイズ監視スクリプト</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-07-02T00:00:00+09:00" pubdate data-updated="true">2015-07-02 (Thu)</time>
        
      </p>
    
  </header>


  <div class="entry-content"><div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. 環境</a></li>
<li><a href="#sec-2">2. スクリプト</a></li>
<li><a href="#sec-3">3. テスト用プログラム</a></li>
<li><a href="#sec-4">4. 監視してみる</a></li>
<li><a href="#sec-5">5. 出力形式</a></li>
<li><a href="#sec-6">6. 2015/08/05 更新</a></li>
</ul>
</div>
</div>
<p>
<code>/proc/&lt;pid&gt;/smaps</code> プロセスメモリマッピングファイルからjavaスレッドのスタック使用状
況をいい感じに出力するスクリプトを作りました。
</p>

<p>
</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2015-07-02-%5B%E5%B0%8F%E9%81%93%E5%85%B7%5D%5Bjava%5D%E3%82%B9%E3%82%BF%E3%83%83%E3%82%AF%E3%82%B5%E3%82%A4%E3%82%BA%E7%9B%A3%E8%A6%96%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88.html">Read on &rarr;</a>
    </footer>
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/2">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <!-- create at 2017/07/01 
       Google Chart Tools: Infographics
       https://developers.google.com/chart/infographics/docs/qr_codes?csw=1
  -->

  <div style="position: relative; text-align: center">

    <!-- Google Chart API でQRコード取得 -->
    <img src="http://chart.apis.google.com/chart?chs=180x180&amp;cht=qr&amp;choe=UTF-8&amp;chl=http://luozengbin.github.io/index.html" alt="post-qrcode" height="180" width="180" />

    <!-- サイトのfaviconを重ねて表示する -->
    <div style="position: absolute; top: 75px; width: 100%; margin: 0 auto; text-align: center">
      <img style="border: 0.2em solid #FFF;" src="/favicon.png" alt="post-qrcode" height="30" width="30" />
    </div>
  </div>

</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015-09-01-%5Btips%5D%5Bjava%5Dcodecache%E9%A0%98%E5%9F%9F%E4%BD%BF%E7%94%A8%E7%8A%B6%E6%B3%81%E3%81%AE%E7%A2%BA%E8%AA%8D%E6%96%B9%E6%B3%95.html">[tips][Java]CodeCache領域使用状況の確認方法</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015-08-30-%5Bjava%E9%81%93%E5%85%B7%5Djstat--gc%E3%81%AE%E5%87%BA%E5%8A%9B%E3%82%92%E8%A6%8B%E3%82%84%E3%81%99%E3%81%8F%E3%81%99%E3%82%8B.html">[Java道具]jstat -gcの出力を見やすくする</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015-08-29-%5Btips%5D%5Blinux%5D%E6%97%A7%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3centos%E3%81%A7yum%E6%9B%B4%E6%96%B0%E3%81%A7%E3%81%8D%E3%81%AA%E3%81%8F%E3%81%AA%E3%81%A3%E3%81%9F%E6%99%82.html">[tips][Linux]旧バージョンCentOSでyum更新できなくなった時</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015-08-29-%5Btips%5D%5Bjava%5Dopenjdk8%E4%BB%98%E5%B1%9E%E3%83%84%E3%83%BC%E3%83%AB%E5%AE%9F%E8%A1%8C%E6%99%82%E3%82%A8%E3%83%A9%E3%83%BC%E3%81%AE%E5%AF%BE%E7%AD%96.html">[tips][Java]OpenJDK8付属ツール実行時エラーの対策</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015-08-07-%5Btips%5D%5Blinux%5Dfirefox%E8%B5%B7%E5%8B%95%E6%99%82%E3%81%AB%E3%83%97%E3%83%AD%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E9%81%B8%E6%8A%9E%E5%87%BA%E6%9D%A5%E3%82%8B%E3%82%88%E3%81%86%E3%81%AB%E3%81%99%E3%82%8B.html">[tips][Linux]Firefox起動時にプロファイル選択出来るようにする</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015-08-02-%5Bmemo%5D%5Blinux%5Dbash%E7%92%B0%E5%A2%83%E3%81%ABpeco%E3%82%92%E5%B0%8E%E5%85%A5%E3%81%97%E3%81%BE%E3%81%97%E3%81%9F.html">[Memo][Linux]bash環境にpecoを導入しました</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015-07-23-%5Btips%5D%5Blinux%5Dsamba%E3%83%A6%E3%83%BC%E3%82%B6%E3%81%AE%E3%83%91%E3%82%B9%E3%83%AF%E3%83%BC%E3%83%89%E5%A4%89%E6%9B%B4.html">[tips][Linux]Sambaユーザのパスワード変更</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015-07-23-%5Btips%5D%5Blinux%5Ddocker%E3%81%AE%E3%83%97%E3%83%AD%E3%82%AD%E3%82%B7%E8%A8%AD%E5%AE%9A.html">[tips][Linux]Dockerのプロキシ設定</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015-07-15-%5Bemacs%5Dmew%E8%B5%B7%E5%8B%95%E6%99%82%E3%81%AB%E3%82%A2%E3%82%AB%E3%82%A6%E3%83%B3%E3%83%88%E3%81%AE%E9%81%B8%E6%8A%9E%E3%82%92%E5%87%BA%E6%9D%A5%E3%82%8B%E3%82%88%E3%81%86%E3%81%AB.html">[Emacs]mew起動時にアカウントの選択を出来るように</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015-07-02-%5B%E5%B0%8F%E9%81%93%E5%85%B7%5D%5Bjava%5D%E3%82%B9%E3%82%BF%E3%83%83%E3%82%AF%E3%82%B5%E3%82%A4%E3%82%BA%E7%9B%A3%E8%A6%96%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88.html">[小道具][Java]スタックサイズ監視スクリプト</a>
      </li>
    
  </ul>
</section>



<section>
  <h1>Categories</h1>
    <ul id="category-list"><li><a href='/blog/categories/emacs/'>emacs (3)</a></li><li><a href='/blog/categories/java/'>java (21)</a></li><li><a href='/blog/categories/linux/'>linux (24)</a></li><li><a href='/blog/categories/misc/'>misc (2)</a></li></ul>
</section>
<section>
  <h1>Tag Cloud</h1>
    <span id="tag-cloud"><a href='/blog/tags/adf' style='font-size: 120.0%'>ADF(1)</a> <a href='/blog/tags/apache' style='font-size: 120.0%'>apache(1)</a> <a href='/blog/tags/awk' style='font-size: 120.0%'>awk(1)</a> <a href='/blog/tags/bash' style='font-size: 120.0%'>bash(1)</a> <a href='/blog/tags/byteman' style='font-size: 160.0%'>Byteman(3)</a> <a href='/blog/tags/cms' style='font-size: 120.0%'>cms(1)</a> <a href='/blog/tags/codecache' style='font-size: 120.0%'>CodeCache(1)</a> <a href='/blog/tags/ddskk' style='font-size: 120.0%'>ddskk(1)</a> <a href='/blog/tags/debug' style='font-size: 120.0%'>debug(1)</a> <a href='/blog/tags/docker' style='font-size: 120.0%'>docker(1)</a> <a href='/blog/tags/ffmpeg' style='font-size: 120.0%'>ffmpeg(1)</a> <a href='/blog/tags/find' style='font-size: 120.0%'>find(1)</a> <a href='/blog/tags/firefox' style='font-size: 120.0%'>firefox(1)</a> <a href='/blog/tags/firewalld' style='font-size: 120.0%'>firewalld(1)</a> <a href='/blog/tags/gc' style='font-size: 120.0%'>gc(1)</a> <a href='/blog/tags/gnuplot' style='font-size: 120.0%'>gnuplot(1)</a> <a href='/blog/tags/iops' style='font-size: 120.0%'>iops(1)</a> <a href='/blog/tags/iptables' style='font-size: 120.0%'>iptables(1)</a> <a href='/blog/tags/javabeans' style='font-size: 120.0%'>JavaBeans(1)</a> <a href='/blog/tags/jboss' style='font-size: 120.0%'>jboss(1)</a> <a href='/blog/tags/jboss-as' style='font-size: 120.0%'>jboss-as(1)</a> <a href='/blog/tags/jboss-lci' style='font-size: 120.0%'>jboss-lci(1)</a> <a href='/blog/tags/jbossas' style='font-size: 160.0%'>JBossAS(3)</a> <a href='/blog/tags/jdev' style='font-size: 120.0%'>jdev(1)</a> <a href='/blog/tags/jenkins' style='font-size: 120.0%'>jenkins(1)</a> <a href='/blog/tags/jmc' style='font-size: 120.0%'>jmc(1)</a> <a href='/blog/tags/journald' style='font-size: 120.0%'>journald(1)</a> <a href='/blog/tags/jstat' style='font-size: 120.0%'>jstat(1)</a> <a href='/blog/tags/jvm' style='font-size: 140.0%'>jvm(2)</a> <a href='/blog/tags/kerberos' style='font-size: 120.0%'>kerberos(1)</a> <a href='/blog/tags/kerbrose' style='font-size: 120.0%'>kerbrose(1)</a> <a href='/blog/tags/ldap' style='font-size: 120.0%'>LDAP(1)</a> <a href='/blog/tags/lpic' style='font-size: 120.0%'>lpic(1)</a> <a href='/blog/tags/lvm' style='font-size: 120.0%'>lvm(1)</a> <a href='/blog/tags/mew' style='font-size: 120.0%'>mew(1)</a> <a href='/blog/tags/misc' style='font-size: 120.0%'>misc(1)</a> <a href='/blog/tags/otcopress' style='font-size: 140.0%'>Otcopress(2)</a> <a href='/blog/tags/passwd' style='font-size: 140.0%'>passwd(2)</a> <a href='/blog/tags/peco' style='font-size: 120.0%'>peco(1)</a> <a href='/blog/tags/r' style='font-size: 120.0%'>R(1)</a> <a href='/blog/tags/rfc3986' style='font-size: 120.0%'>rfc3986(1)</a> <a href='/blog/tags/sa' style='font-size: 120.0%'>SA(1)</a> <a href='/blog/tags/samba' style='font-size: 120.0%'>samba(1)</a> <a href='/blog/tags/sas' style='font-size: 120.0%'>SAS(1)</a> <a href='/blog/tags/smtp' style='font-size: 120.0%'>smtp(1)</a> <a href='/blog/tags/socket' style='font-size: 120.0%'>socket(1)</a> <a href='/blog/tags/sort' style='font-size: 120.0%'>sort(1)</a> <a href='/blog/tags/ssh' style='font-size: 120.0%'>ssh(1)</a> <a href='/blog/tags/stack' style='font-size: 140.0%'>stack(2)</a> <a href='/blog/tags/swap' style='font-size: 120.0%'>swap(1)</a> <a href='/blog/tags/sync' style='font-size: 120.0%'>sync(1)</a> <a href='/blog/tags/syslog' style='font-size: 120.0%'>syslog(1)</a> <a href='/blog/tags/tcp' style='font-size: 160.0%'>tcp(3)</a> <a href='/blog/tags/virtualbox' style='font-size: 120.0%'>VirtualBox(1)</a> <a href='/blog/tags/vpn' style='font-size: 120.0%'>vpn(1)</a> <a href='/blog/tags/weblogic' style='font-size: 140.0%'>weblogic(2)</a> <a href='/blog/tags/xauth' style='font-size: 120.0%'>xauth(1)</a> <a href='/blog/tags/xhost' style='font-size: 120.0%'>xhost(1)</a> <a href='/blog/tags/yum' style='font-size: 120.0%'>yum(1)</a> <a href='/blog/tags/zabbix' style='font-size: 120.0%'>zabbix(1)</a> </span>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/luozengbin">@luozengbin</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'luozengbin',
            count: 1,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">
  <img alt="クリエイティブ・コモンズ・ライセンス" style="border-width:0" src="https://i.creativecommons.org/l/by-nc/4.0/88x31.png" /></a>
  この作品は
    <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">クリエイティブ・コモンズ 表示 - 非営利 4.0 国際 ライセンスの下に提供されています。</a>
    <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'luozengbin';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
